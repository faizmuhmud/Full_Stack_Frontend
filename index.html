<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School Classes</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <h1>{{ appName }}</h1>
            <nav>
                <button @click="showLessons" :class="{ active: currentPage === 'lessons' }">Lessons</button>
                <button v-if="cartCount > 0" @click="showCart" :class="{ active: currentPage === 'cart' }">
                    üõí Cart ({{ cartCount }})
                </button>
                <button v-if="cartCount > 0" @click="showCheckout" :class="{ active: currentPage === 'checkout' }">
                    Checkout
                </button>
            </nav>
        </header>

        <main class="container">
            <!-- LESSONS PAGE -->
            <section v-if="currentPage === 'lessons'">
                <h2>Available Classes</h2>
                <div v-if="loading" class="loading">Loading lessons...</div>
                <div v-else-if="error" class="error">{{ error }}</div>
                <div v-else>
                    <div class="search-container">
                        <input class="search-input" v-model="searchQuery" placeholder="Search classes...">
                        <button v-if="searchQuery" class="clear-btn" @click="searchQuery=''">‚úï</button>
                    </div>
                    <div class="sort-container">
                        <label>Sort by:</label>
                        <select class="sort-select" v-model="sortBy">
                            <option value="">-- Select --</option>
                            <option value="subject">Subject</option>
                            <option value="location">Location</option>
                            <option value="price">Price</option>
                            <option value="availability">Availability</option>
                        </select>
                        <select class="sort-select" v-model="sortOrder" :disabled="!sortBy">
                            <option value="asc">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </div>
                    <div class="lessons-grid">
                        <div v-for="lesson in sortedLessons" :key="lesson.id" class="lesson-card">
                            <div class="lesson-image">
                                <img :src="lesson.image">
                            </div>
                            <div class="lesson-details">
                                <h3>{{ lesson.subject }}</h3>
                                <p>üìç {{ lesson.location }}</p>
                                <p class="price">AED {{ lesson.price }}</p>
                                <p>Spaces: {{ lesson.spaces }}</p>
                                <button class="add-btn" :disabled="lesson.spaces === 0" @click="addToCart(lesson)">
                                    {{ lesson.spaces > 0 ? "Add to Cart" : "Sold Out" }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CART PAGE -->
            <section v-if="currentPage === 'cart'" class="cart-section">
                <h2>Your Cart</h2>
                <div v-for="item in cart" :key="item.id" class="cart-item">
                    <div>
                        <h3>{{ item.subject }}</h3>
                        <p>{{ item.location }}</p>
                        <p style="font-size:1.2rem;color:#ffd700">AED {{ item.price }}</p>
                    </div>
                    <div class="qty-controls">
                        <button class="qty-btn" @click="decreaseQty(item)">‚àì</button>
                        <span style="font-size:1.3rem">{{ item.qty }}</span>
                        <button class="qty-btn" @click="increaseQty(item)">+</button>
                    </div>
                    <button class="remove-btn" @click="removeLesson(item)">Remove</button>
                </div>
                <div class="cart-summary">
                    <h3>Total: AED {{ cartTotal }}</h3>
                    <button class="checkout-btn" @click="showCheckout">Proceed to Checkout</button>
                </div>
            </section>

            <!-- CHECKOUT PAGE WITH GIFT OPTION -->
            <section v-if="currentPage === 'checkout'" class="checkout-form">
                <h2>Customer Details</h2>

                <label>First Name</label>
                <input v-model="customer.firstName" @blur="validateField('firstName')" @input="validateField('firstName')">
                <span v-if="errors.firstName" class="error-message">{{ errors.firstName }}</span>

                <label>Last Name</label>
                <input v-model="customer.lastName" @blur="validateField('lastName')" @input="validateField('lastName')">
                <span v-if="errors.lastName" class="error-message">{{ errors.lastName }}</span>

                <label>City</label>
                <input v-model="customer.city" @blur="validateField('city')" @input="validateField('city')">
                <span v-if="errors.city" class="error-message">{{ errors.city }}</span>

                <label>Address</label>
                <textarea v-model="customer.address" @blur="validateField('address')" @input="validateField('address')"></textarea>
                <span v-if="errors.address" class="error-message">{{ errors.address }}</span>

                <label>Postal Code</label>
                <input v-model="customer.postal" @blur="validateField('postal')" @input="validateField('postal')">
                <span v-if="errors.postal" class="error-message">{{ errors.postal }}</span>

                <!-- GIFT TOGGLE -->
                <div class="gift-toggle">
                    <input type="checkbox" v-model="customer.isGift">
                    <label>Is this a gift?</label>
                </div>

                <button class="submit-btn" @click="submitOrder">
                    Complete Order
                </button>

                <!-- ORDER SUMMARY -->
                <div class="order-summary">
                    <h3>Order Summary</h3>
                    <p><strong>First Name:</strong> {{ customer.firstName }}</p>
                    <p><strong>Last Name:</strong> {{ customer.lastName }}</p>
                    <p><strong>Address:</strong> {{ customer.address }}</p>
                    <p><strong>City:</strong> {{ customer.city }}</p>
                    <p><strong>Postal Code:</strong> {{ customer.postal }}</p>
                    <p><strong>Gift:</strong> {{ customer.isGift ? 'Yes' : 'No' }}</p>
                    <p><strong>Items in Cart:</strong> {{ cartCount }}</p>
                    <p><strong>Total:</strong> AED {{ cartTotal }}</p>
                </div>
            </section>
        </main>
    </div>
    <script src="app.js"></script>
</body>
</html>